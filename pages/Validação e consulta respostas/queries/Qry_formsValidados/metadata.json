{
  "gitSyncId": "692f23e7862bc92544420b37_ae5c3919-d9a3-461d-aaa6-af0c30395491",
  "id": "Validação e consulta respostas_Qry_formsValidados",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH val_por_utilizador AS (\n  SELECT\n    id_utilizador,\n    ano,\n    CASE\n      WHEN COUNT(DISTINCT CASE WHEN dominio IN ('ambiental','social','económico') THEN dominio END) = 3\n       AND SUM(CASE WHEN dominio IN ('ambiental','social','económico') AND validacao <> 'S' THEN 1 ELSE 0 END) = 0\n      THEN 1 ELSE 0\n    END AS formulario_validado\n  FROM respostas\n  GROUP BY id_utilizador, ano\n)\nSELECT\n  ano,\n  SUM(formulario_validado) AS total_formularios_validados\nFROM val_por_utilizador\nGROUP BY ano\nORDER BY ano;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "pg_alquevaustentavel",
      "isAutoGenerated": false,
      "name": "pg_alquevaustentavel",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [],
    "name": "Qry_formsValidados",
    "pageId": "Validação e consulta respostas",
    "runBehaviour": "AUTOMATIC",
    "userSetOnLoad": false
  }
}