SELECT 
  p.categoria,
  r.id_utilizador,
  COUNT(*) AS total_perguntas,
  SUM(CASE WHEN r.resposta = 'Yes' THEN 1 ELSE 0 END) AS total_yes,
  CASE
    WHEN SUM(CASE WHEN r.resposta = 'Yes' THEN 1 ELSE 0 END) = 0 THEN 25
    WHEN SUM(CASE WHEN r.resposta = 'Yes' THEN 1 ELSE 0 END) < COUNT(*) THEN 50
    WHEN SUM(CASE WHEN r.resposta = 'Yes' THEN 1 ELSE 0 END) = COUNT(*) THEN 100
  END AS pontuacao
FROM respostas r
JOIN perguntas p ON r.id_pergunta = p.id_pergunta
WHERE r.id_utilizador = {{appsmith.user.email}}  -- temporarily hardcoded
GROUP BY r.id_utilizador, p.categoria
ORDER BY p.categoria;
